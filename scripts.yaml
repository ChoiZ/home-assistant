#########################################################

tv_on:
  alias: "tv on"
  sequence:
  - service: notify.slack
    data_template:
        title: "call tv on"
  - service: switch.turn_on
    entity_id: switch.64680137bcddc2542a40 # tv
  - service: switch.turn_on
    entity_id: switch.freeboxtv_socket
  - delay:
      milliseconds: 500
  - service: switch.turn_on
    entity_id: switch.ampli

#########################################################

tv_off:
  alias: "tv off"
  sequence:
  - service: notify.slack
    data_template:
        title: "call tv off"
  - service: switch.turn_off
    entity_id: switch.ampli
  - delay:
      milliseconds: 500
  - service: switch.turn_off
    entity_id: switch.tv
  - delay:
      milliseconds: 500
  - service: switch.turn_off
    entity_id: switch.64680137bcddc2542a40 # tv
  - service: switch.turn_off
    entity_id: switch.freeboxtv_socket

#########################################################

close_bedroom_shutter:
  alias: "close bedroom shutter"
  sequence:
  - service: notify.slack
    data_template:
        title: "close bedroom shutter"
        message: "fermeture {{ cover_entity_id }}"
  - service: input_boolean.turn_off
    data_template:
      entity_id: "{{ input_boolean_entity_id }}"
  - service: cover.close_cover
    data_template:
      entity_id: "{{ cover_entity_id }}"
  - delay:
      milliseconds: 16900
  - service: cover.stop_cover
    data_template:
      entity_id: "{{ cover_entity_id }}"

#########################################################

open_shutter:
  sequence:
    - service: notify.slack
      data_template:
        title: "ouverture volet"
        message: "ouverture {{ cover_entity_id }}"
    - service: cover.open_cover
      data_template:
        entity_id: "{{ cover_entity_id }}"
    - service: input_boolean.turn_on
      data_template:
        entity_id: "{{ input_boolean_entity_id }}"

#########################################################

close_shutter:
  sequence:
    - service: notify.slack
      data_template:
        title: "fermeture volet"
        message: "fermeture {{ cover_entity_id }}"
    - service: cover.close_cover
      data_template:
        entity_id: "{{ cover_entity_id }}"
    - service: input_boolean.turn_off
      data_template:
        entity_id: "{{ input_boolean_entity_id }}"

#########################################################

start_alarm:
  alias: "[alarm] started"
  sequence:
    - condition: state
      entity_id: input_boolean.disable_alarm
      state: 'off'
    - service: xiaomi_aqara.play_ringtone
      data:
        ringtone_id: 7
        ringtone_vol: 3
    - delay: '00:00:20'
    - service: script.turn_on
      data:
        entity_id: script.alarm_loop

alarm_loop:
  sequence:
    - delay:
        milliseconds: 500
    - service: script.turn_on
      data:
        entity_id: script.start_alarm

#########################################################

flash_light:
  sequence:
    - condition: state
      entity_id: input_boolean.disable_alarm
      state: 'off'
    - service: light.turn_on
      data:
        entity_id: light.gateway_light_04cf8cb87b01
        brightness_pct: 2
        color_name: red
    - delay:
        milliseconds: 500
    - service: light.turn_off
      data:
        entity_id: light.gateway_light_04cf8cb87b01
    - service: script.turn_on
      data:
        entity_id: script.flash_loop

flash_loop:
  sequence:
    - delay:
        milliseconds: 500
    - service: script.turn_on
      data:
        entity_id: script.flash_light
